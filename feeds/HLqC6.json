{"items": [{"updated": 1363915956, "alternate": [{"href": "http://charsyam.wordpress.com/2013/03/22/%ec%9e%85-%ea%b0%9c%eb%b0%9c-redis-tips/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Redis Tips", "author": "charsyam", "content": {"content": "\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1479/\"></a> "}, "published": 1363915956, "categories": []}, {"updated": 1363099269, "alternate": [{"href": "http://charsyam.wordpress.com/2013/03/12/%ec%9e%85-%ea%b0%9c%eb%b0%9c-redis-pubsub-%ec%8b%9c%ec%8a%a4%ed%85%9c%ec%9d%80-%ec%9d%bc%eb%b0%98%ec%a0%81%ec%9d%b8-message-queue%ec%99%80-%eb%8b%a4%eb%a5%b4%eb%8b%a4/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Redis Pub/Sub \uc2dc\uc2a4\ud15c\uc740 \uc77c\ubc18\uc801\uc778 Message Queue\uc640 \ub2e4\ub974\ub2e4.", "author": "charsyam", "content": {"content": "<p> Redis Issue \uc5d0 \uc7ac\ubbf8\uc788\ub294 \uc9c8\ubb38\uc774 \uc62c\ub77c\uc654\uc2b5\ub2c8\ub2e4. <a href=\"https://github.com/antirez/redis/issues/998\">https://github.com/antirez/redis/issues/998</a> Redis Pub/Sub \uc5d0 maximum \uac12\uc744 \uc124\uc815\ud558\uace0 \uc2f6\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4. \uc544\ub9c8\ub3c4 \uc774 \ubd84\uc740 Redis Pub/Sub\uc744 \uc77c\uc885\uc758 Message Queue\ub85c \ucc29\uac01\ud558\uace0 \uc788\ub294 \uac83\uc785\ub2c8\ub2e4.</p>\n<p> \ubb50, \ucc98\uc74c\ubd80\ud130 \uc9d1\uace0 \ub118\uc5b4\uac00\uc790\uba74, \ub2f9\uc5f0\ud788 Pub/Sub System\uacfc Message Queue\ub294 \ub2e4\ub978 \uac83\uc785\ub2c8\ub2e4. \uba3c\uc800, Pub/Sub System\uc740 \ud604\uc7ac \ucc44\ub110\uc5d0 \uac00\uc785\ud55c Subscriber \ub4e4 \ubaa8\ub450\uc5d0\uac8c \ud2b9\uc815 \uc774\ubca4\ud2b8\ub97c \uc804\ub2ec\ud558\ub294 \uac83\uc785\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uba54\uc2dc\uc9c0 \ud050\ub294 \ubcf4\ud1b5 \uc77c\ubc18\uc801\uc73c\ub85c \uc791\uc5c5\uc744 \ud050\uc789\ud558\uace0 \uc788\ub2e4\uac00 \uc694\uccad\ud558\ub294 \uacf3\uc5d0 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud558\uae30 \uc704\ud574\uc11c \ubcf4\uad00\ud558\ub294 \uc2dc\uc2a4\ud15c\uc785\ub2c8\ub2e4. \uadf8\ub7f0\ub370 \uc77c\ubc18\uc801\uc73c\ub85c Pub/Sub\uc744 \uc81c\uacf5\ud558\ub294 \uc2dc\uc2a4\ud15c\ub4e4\uc774, \uc77c\uc885\uc758 \uba54\uc2dc\uc9c0 \ud050\ucc98\ub7fc \ub370\uc774\ud130\ub97c \ubcf4\uad00\ud558\ub294 \uc5ed\ud560\uc744 \ud55c\ub2e4\ub294 \uac83\uc774, \ub2e8\uc21c\ud788 Redis\ub97c \uc0ac\uc6a9\ud560 \uacbd\uc6b0, \ucc29\uac01\ud558\uac8c \ub429\ub2c8\ub2e4.</p>\n<p> redis\uc5d0\uc11c \uc5b4\ub5a4 client \ub3c4 subscribe \ud558\uc9c0 \uc54a\uc740 \uacbd\uc6b0 publish \ud558\uac8c \ub418\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uacb0\uacfc\ub97c \uc5bb\uac8c \ub429\ub2c8\ub2e4.</p>\n\nredis 127.0.0.1:6379&gt; publish abc 123\n(integer) 0\n\n<p> \ub9ac\ud134\uac12\uc740 \uba87\uac1c\uc758 subscriber \uc5d0\uac8c \uba54\uc2dc\uc9c0\ub97c \uc804\ub2ec\ud588\ub2e4\ub294 \uacb0\uacfc\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. \uc989, redis\ub97c \uac00\uc9c0\uace0 \ub2e8\uc21c\ud788 \ubbf8\ub9ac publish \ud574\ub450\uace0 \ub098\uc911\uc5d0 \ub2e4\ub978 subscriber\uac00 subscribe \ud560 \uacbd\uc6b0\uc5d0\ub294 \uc55e\uc5d0 publish\ud55c \ub370\uc774\ud130\ub294 \uc804\ubd80 \uc720\uc2e4\ub418\uac8c \ub429\ub2c8\ub2e4. </p>\n<p> \ud574\ub2f9 publish \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\ub354\ub77c\ub3c4, \ub2e8\uc21c\ud788 channel\uc744 \ucc3e\uc544\uc11c \uc5f0\uacb0\ub41c \ud074\ub77c\uc774\uc5b8\ud2b8 \uc815\ubcf4\ub9cc \uccb4\ud06c\ud558\uc9c0 \ub530\ub85c \uc800\uc7a5\ud558\ub294 \ubd80\ubd84\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \uc989 \ub531 \uae30\ubcf8\uc801\uc778 pub/sub \uc5d0\ub9cc \uc9d1\uc911\ud55c \ud615\ud0dc\uc785\ub2c8\ub2e4.</p>\n\n/* Publish a message */\nint pubsubPublishMessage(robj *channel, robj *message) {\n    int receivers &#61; 0;\n    struct dictEntry *de;\n    listNode *ln;\n    listIter li;\n\n    /* Send to clients listening for that channel */\n    de &#61; dictFind(server.pubsub_channels,channel);\n    if (de) {\n        list *list &#61; dictGetVal(de);\n        listNode *ln;\n        listIter li;\n\n        listRewind(list,&amp;li);\n        while ((ln &#61; listNext(&amp;li)) !&#61; NULL) {\n            redisClient *c &#61; ln-&gt;value;\n\n            addReply(c,shared.mbulkhdr[3]);\n            addReply(c,shared.messagebulk);\n            addReplyBulk(c,channel);\n            addReplyBulk(c,message);\n            receivers&#43;&#43;;\n        }\n    }\n    /* Send to clients listening to matching channels */\n    if (listLength(server.pubsub_patterns)) {\n        listRewind(server.pubsub_patterns,&amp;li);\n        channel &#61; getDecodedObject(channel);\n        while ((ln &#61; listNext(&amp;li)) !&#61; NULL) {\n            pubsubPattern *pat &#61; ln-&gt;value;\n\n            if (stringmatchlen((char*)pat-&gt;pattern-&gt;ptr,\n                                sdslen(pat-&gt;pattern-&gt;ptr),\n                                (char*)channel-&gt;ptr,\n                                sdslen(channel-&gt;ptr),0)) {\n                addReply(pat-&gt;client,shared.mbulkhdr[4]);\n                addReply(pat-&gt;client,shared.pmessagebulk);\n                addReplyBulk(pat-&gt;client,pat-&gt;pattern);\n                addReplyBulk(pat-&gt;client,channel);\n                addReplyBulk(pat-&gt;client,message);\n                receivers&#43;&#43;;\n            }\n        }\n        decrRefCount(channel);\n    }\n    return receivers;\n}\n\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1475/\"></a> "}, "published": 1363099269, "categories": []}, {"updated": 1361611311, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/23/%ec%9e%85-%ea%b0%9c%eb%b0%9c-memcache-%ec%99%80-redis-%ec%97%90%ec%84%9c-incrdecr-%ec%9d%80-%ec%96%b4%eb%96%bb%ea%b2%8c-%eb%8f%99%ec%9e%91%ed%95%a0%ea%b9%8c/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Memcache \uc640 Redis \uc5d0\uc11c incr/decr \uc740 \uc5b4\ub5bb\uac8c \ub3d9\uc791\ud560\uae4c?", "author": "charsyam", "content": {"content": "<p> \ucd5c\uadfc\uc5d0 \u201cmemcache\uc5d0\uc11c incr/decr \uc758 \uacbd\uc6b0\uc5d0 int/long \uc5d0 \ub530\ub77c\uc11c \ud2b9\ubcc4\ud55c \uc774\uc288\uac00 \ubc1c\uc0dd\ud558\uc9c0 \uc54a\ub294\uac00?\u201d \uc5d0 \ub300\ud55c \uc9c8\ubb38\uc744 \ubc1b\uc558\uc2b5\ub2c8\ub2e4. \uba3c\uc800 \uacb0\ub860\ubd80\ud130 \ub9d0\ud558\uba74 memcache/redis \uc5d0\uc11c \uc774\ub85c \uc778\ud574\uc11c \ubc1c\uc0dd\ud558\ub294 \ud2b9\ubcc4\ud55c \uc774\uc288\ub294 \uc5c6\uc2b5\ub2c8\ub2e4. \uae30\ubcf8\uc801\uc73c\ub85c memcache/redis \uac00 \ubaa8\ub4e0 \uac12\uc744 \uc2a4\ud2b8\ub9c1 \ud615\ud0dc\ub85c \uc800\uc7a5\ud558\uae30 \ub54c\ubb38\uc785\ub2c8\ub2e4.(\ub2e4\ub9cc redis\ub294 \uc880 \ubcf5\uc7a1\ud569\ub2c8\ub2e4.) \uadf8\ub9ac\uace0 \uc774 \uac12\uc744 strtoll \uac19\uc740 \ud568\uc218\ub97c \uc774\uc6a9\ud574\uc11c integer \ud615\ud0dc\ub85c \ubc14\uafbc\ub2e4\uc74c\uc5d0 delta \uac12\uc744 \uc800\uc7a5\ud558\ub294 \ud615\ud0dc\uae30 \ub54c\ubb38\uc5d0 \uadf8\ub807\uc2b5\ub2c8\ub2e4. \uadf8\ub9ac\uace0 memcache/redis \ubaa8\ub450 incr/decr\uc774 \uc2e4\uc81c\ub85c\ub294 \ud558\ub098\uc758 \ucf54\ub4dc\ub85c \ub3d9\uc791\ud569\ub2c8\ub2e4.( &#43;/- \uc77c\ubfd0\uc774\ub2c8\uae50\uc694)</p>\n<p> memecache \ucabd \uc18c\uc2a4\ub97c \uc0b4\ud3b4\ubcf4\uba74 process_arithmetic_command() \ud568\uc218\uc5d0\uc11c incr/decr\uc744 \ucc98\ub9ac\ud558\uac8c \ub429\ub2c8\ub2e4.</p>\n\nstatic void process_arithmetic_command(conn *c, token_t *tokens, const size_t ntokens, const bool incr) {\n    char temp[INCR_MAX_STORAGE_LEN];\n    uint64_t delta;\n    char *key;\n    size_t nkey;\n\n    assert(c !&#61; NULL);\n\n    set_noreply_maybe(c, tokens, ntokens);\n\n    if (tokens[KEY_TOKEN].length &gt; KEY_MAX_LENGTH) {\n        out_string(c, &#34;CLIENT_ERROR bad command line format&#34;);\n        return;\n    }    \n\n    key &#61; tokens[KEY_TOKEN].value;\n    nkey &#61; tokens[KEY_TOKEN].length;\n\n    if (!safe_strtoull(tokens[2].value, &amp;delta)) {\n        out_string(c, &#34;CLIENT_ERROR invalid numeric delta argument&#34;);\n        return;\n    }\n\n    switch(add_delta(c, key, nkey, incr, delta, temp, NULL)) {\n    case OK:\n        out_string(c, temp);\n        break;\n    case NON_NUMERIC:\n        out_string(c, &#34;CLIENT_ERROR cannot increment or decrement non-numeric value&#34;);\n        break;\n    case EOM:\n        out_string(c, &#34;SERVER_ERROR out of memory&#34;);\n        break;\n\n    case DELTA_ITEM_NOT_FOUND:\n        pthread_mutex_lock(&amp;c-&gt;thread-&gt;stats.mutex);\n        if (incr) {\n            c-&gt;thread-&gt;stats.incr_misses&#43;&#43;;\n        } else {\n            c-&gt;thread-&gt;stats.decr_misses&#43;&#43;;\n        }\n        pthread_mutex_unlock(&amp;c-&gt;thread-&gt;stats.mutex);\n\n        out_string(c, &#34;NOT_FOUND&#34;);\n        break;\n    case DELTA_ITEM_CAS_MISMATCH:\n        break; /* Should never get here */\n    }\n}\n\n<p> \uc704\uc758 \uc18c\uc2a4\ub97c \ubcf4\uba74 strtoull() \uc744 \ub798\ud551\ud55c safe_strtoull() \ud568\uc218\uac00 \uc788\ub294\ub370, \ucc98\uc74c\uc5d0\ub294 \uba3c\uc800 incr/decr \ub2e4\uc74c\uc758 delta \uac12\uc744 integer \ud615\ud0dc\ub85c \ubc14\uafb8\ub294 \ubd80\ubd84\uc785\ub2c8\ub2e4. \uc2e4\uc81c value \uac12\uc740 add_delta \ud568\uc218\uc5d0\uc11c \uc774\ub8e8\uc5b4\uc9d1\ub2c8\ub2e4. \uc2e4\uc81c\ub85c add_delta()\ub294 do_add_delta() \ub97c \ud638\ucd9c\ud558\uace0 \uac70\uae30\uc11c \ub2e4\uc2dc safe_strtoull() \ud568\uc218\ub97c \uc774\uc6a9\ud574\uc11c value\ub97c integer\ub85c \ubcc0\ud658\ud569\ub2c8\ub2e4. \uadf8\ub7f0\ub370 \uc5ec\uae30\uc11c \uc911\uc694\ud55c \uc810\uc740 \uc774\ub7f0 \uc5f0\uc0b0\uacfc\uc815\uc774 \uc544\ub2c8\ub77c strtoull() \ud568\uc218\uc785\ub2c8\ub2e4. \uc22b\uc790\ud615\uc774 \uc544\ub2c8\uba74 \uc608\ub97c \ub4e4\uc5b4 value \uac00 \u201c123\u2033 \ud615\ud0dc\uac00 \uc544\ub2cc \u201cabc\u201d \uc774\ub7f0 \uac12\uc774 \uc788\ub2e4\uba74, \uc2e4\ud328\ud558\uace0 \uc774\uc5d0 \ub300\ud574\uc11c \uc2e4\ud328\ub85c \ub9ac\ud134\ud558\uac8c \ub429\ub2c8\ub2e4. <strong>\uc989 \uc22b\uc790\ud615\ud0dc\ub85c \ubcc0\ud658\ub418\uc9c0 \uc54a\ub294 \ub370\uc774\ud130\ub97c \ub123\uc73c\uba74 incr/decr \uc5f0\uc0b0\uc740 \uc2e4\ud328\ud558\uac8c \ub429\ub2c8\ub2e4. \uc989 memcache\uc5d0 \ubc14\uc774\ub108\ub9ac \ud615\ud0dc\ub85c \uc22b\uc790\uac12\uc744 \ub123\ub294\ub2e4\uba74 incr/decr\uc740 \uc4f8 \uc218 \uc5c6\ub2e4\uac00 \ub418\uc5b4\ubc84\ub9ac\ub294 \uac83\uc785\ub2c8\ub2e4.</strong> \uacb0\uad6d \uc548\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 \ud615\ud0dc\ub294 \ud56d\uc0c1 64bit\uc774\ub2c8 \ubb38\uc81c\uac00 \ub420 \uac83\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.</p>\n<p> \uadf8\ub7fc redis\ub294 \uc5b4\ub5a8\uac00\uc694? redis \ub3c4 \uc804\uccb4\uc801\uc73c\ub85c memcache \uc640 \uc720\uc0ac\ud569\ub2c8\ub2e4. \uadf8\ub7f0\ub370!!!, redis\uc5d0\ub294 string \ud615\ud0dc\uc5d0 encoding \ud615\ud0dc\uac00 REDIS_ENCODING_INT \uc778\uac83\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uadf8\ub7fc \uc65c REDIS_ENCODING_INT \ub97c \uc0ac\uc6a9\ud558\ub294\uac00 \ud558\uba74, \uba54\ubaa8\ub9ac\ub97c \ucd5c\ub300\ud55c \uc904\uc774\uae30 \uc704\ud574\uc11c \uc785\ub2c8\ub2e4. \uc2e4\uc81c \ubb38\uc790\uc5f4\uc758 \uacbd\uc6b0 32bit long\uc758 \uacbd\uc6b0 4\uae00\uc790\uc5d0 \uac12\uc774 \ub4e4\uc5b4\uac00\ub294\ub370, \uc2a4\ud2b8\ub9c1\ud615\ud0dc\ub85c \uc800\uc7a5\ud558\uba74 \ub9ce\uc740 \uba54\ubaa8\ub9ac\ub97c \ucc28\uc9c0\ud558\uac8c \ub429\ub2c8\ub2e4. <del>\uc774\uac8c \uc7ac\ubbf8\uc788\ub294\uac8c, \ucd5c\ucd08\uc758 set \uc5d0\ub294 \uc2a4\ud2b8\ub9c1\uc73c\ub85c \uadf8\ub300\ub85c \uc800\uc7a5\uc774 \ub418\uace0, incr/decr \uc774 \ubc1c\uc0dd\ud558\uba74 \uadf8 \ub54c, \uc774 \uacb0\uacfc\uac12\uc774 LONG \ubc94\uc704\uc548\uc5d0 \ub4e4\uc5b4\uac00\uba74 \uc774 \ub54c createStringObjectFromLongLong() \ud568\uc218\ub97c \uc774\uc6a9\ud574\uc11c REDIS_ENCODING_INT \ud615\ud0dc\ub85c \uc800\uc7a5\ud558\uac8c \ub429\ub2c8\ub2e4.</del> \uc815\uc815\ud569\ub2c8\ub2e4. \uc624\uc0b0\ub3cc\uad6c\ub2d8 \ub9d0\uc500\ub300\ub85c setGenericCommand\ub97c \ud638\ucd9c\ud558\uae30 \uc804\uc5d0 \ud30c\ub77c\ub9e4\ud130\uc5d0 \ub300\ud574\uc11c tryObjectEncoding\uc744 \ud638\ucd9c\ud569\ub2c8\ub2e4. \uc5ec\uae30\uc11c long \ubc94\uc704\uc5d0 \ub4e4\uc5b4\uac00\ub294 \uac83 \uc911\uc5d0\uc11c 10000\uc774\ud558\ub294 \uacf5\uc720\ud558\ub294 shared.integers\ub97c \uc0ac\uc6a9\ud558\uace0, \uadf8 \uc774\uc678\uc5d0\ub294 \uc2e4\uc81c\ub85c REDIS_ENCODING_INT\ub85c \uc800\uc7a5\ud569\ub2c8\ub2e4. \uc18c\uc2a4\ub294 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. \uacb0\ub860\uc801\uc73c\ub85c \ucd5c\ucd08\uc5d0 \ub4e4\uc5b4\uac08 \ub54c long \ubc94\uc704\uba74 \ubc14\ub85c \ubcc0\uacbd\ub418\uace0, \uadf8\uac8c \uc544\ub2c8\ub354\ub77c\ub3c4 \ub4a4\uc5d0 \ubcc0\uacbd\ud560 \uc218<br>\n\uc788\uc73c\uba74 \ubcc0\uacbd\ub41c\ub2e4\uace0 \ubcf4\uc2dc\uba74 \ub420\uac83 \uac19\uc2b5\ub2c8\ub2e4.(\uc624\uc0b0\ub3cc\uad6c\ub2d8\uaed8 \uac10\uc0ac\ub97c \u314e\u314e\u314e)</p>\n\nrobj *tryObjectEncoding(robj *o) {\n    long value;\n    sds s &#61; o-&gt;ptr;\n\n    if (o-&gt;encoding !&#61; REDIS_ENCODING_RAW)\n        return o; /* Already encoded */\n\n    /* It&#39;s not safe to encode shared objects: shared objects can be shared\n     * everywhere in the &#34;object space&#34; of Redis. Encoded objects can only\n     * appear as &#34;values&#34; (and not, for instance, as keys) */\n     if (o-&gt;refcount &gt; 1) return o;\n\n    /* Currently we try to encode only strings */\n    redisAssertWithInfo(NULL,o,o-&gt;type &#61;&#61; REDIS_STRING);\n\n    /* Check if we can represent this string as a long integer */\n    if (!string2l(s,sdslen(s),&amp;value)) return o;\n\n    /* Ok, this object can be encoded...\n     *\n     * Can I use a shared object? Only if the object is inside a given range\n     *\n     * Note that we also avoid using shared integers when maxmemory is used\n     * because every object needs to have a private LRU field for the LRU\n     * algorithm to work well. */\n    if (server.maxmemory &#61;&#61; 0 &amp;&amp; value &gt;&#61; 0 &amp;&amp; value &lt; REDIS_SHARED_INTEGERS) {\n        decrRefCount(o);\n        incrRefCount(shared.integers[value]);\n        return shared.integers[value];\n    } else {\n        o-&gt;encoding &#61; REDIS_ENCODING_INT;\n        sdsfree(o-&gt;ptr);\n        o-&gt;ptr &#61; (void*) value;\n        return o;\n    }\n}\n\nvoid incrDecrCommand(redisClient *c, long long incr) {\n    long long value, oldvalue;\n    robj *o, *new;\n\n    o &#61; lookupKeyWrite(c-&gt;db,c-&gt;argv[1]);\n    if (o !&#61; NULL &amp;&amp; checkType(c,o,REDIS_STRING)) return;\n    if (getLongLongFromObjectOrReply(c,o,&amp;value,NULL) !&#61; REDIS_OK) return;\n\n    oldvalue &#61; value;\n    if ((incr &lt; 0 &amp;&amp; oldvalue &lt; 0 &amp;&amp; incr &lt; (LLONG_MIN-oldvalue)) ||\n        (incr &gt; 0 &amp;&amp; oldvalue &gt; 0 &amp;&amp; incr &gt; (LLONG_MAX-oldvalue))) {\n        addReplyError(c,&#34;increment or decrement would overflow&#34;);\n        return;\n    }\n    value &#43;&#61; incr;\n    new &#61; createStringObjectFromLongLong(value);\n    if (o)\n        dbOverwrite(c-&gt;db,c-&gt;argv[1],new);\n    else\n        dbAdd(c-&gt;db,c-&gt;argv[1],new);\n    signalModifiedKey(c-&gt;db,c-&gt;argv[1]);\n    notifyKeyspaceEvent(REDIS_NOTIFY_STRING,&#34;incrby&#34;,c-&gt;argv[1],c-&gt;db-&gt;id);\n    server.dirty&#43;&#43;;\n    addReply(c,shared.colon);\n    addReply(c,new);\n    addReply(c,shared.crlf);\n}\n\n<p> \uc18c\uc2a4\ub97c \ubcf4\uc2dc\uba74 longlong \ud615\ud0dc\ub85c \ubcc0\ud658\ud558\ub294 getLongLongFromObjectOrReply() \ud568\uc218\uac00 \uc2e4\ud328\ud558\uba74 \uc5ed\uc2dc \uc5d0\ub7ec\ub97c \ub9ac\ud134\ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774 \ub54c \uc5ed\uc2dc, \uc0ac\uc6a9\uc790\uac00 \ubc14\uc774\ub108\ub9ac \ud615\ud0dc\ub85c \ub370\uc774\ud130\ub97c \ub123\uc73c\uba74 incr/decr \ub958\uc758 \uba85\ub839\uc5b4\ub294 \uc0ac\uc6a9\ud560 \uc218 \uc5c6\ub2e4\ub294 \uac83\uc744 \uae30\uc5b5\ud558\uc2dc\uba74 \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4.</p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1470/\"></a> "}, "published": 1361611311, "categories": []}, {"updated": 1360658657, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/12/%ec%9e%85-%ea%b0%9c%eb%b0%9c-cassandra-%ec%9d%98-stage-%ec%99%80-seda/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Cassandra \uc758 Stage \uc640 SEDA", "author": "charsyam", "content": {"content": "<p>\ub2e4\ub4e4 \uc54c\uace0 \uc788\ub4ef\uc774 Cassandra \ub294 SEDA \ub77c\ub294 Architecture\ub97c \uc0ac\uc6a9\ud558\uace0 \uc788\uc2b5\ub2c8\ub2e4. SEDA\ub294 \uac04\ub2e8\ud558\uac8c \ub9d0\ud558\uba74 \ub0b4\ubd80\uc801\uc73c\ub85c thread\ub85c \uad6c\ubd84\ub418\ub294 stage \ub77c\ub294 \uac83\ub4e4\uc774 \uc874\uc7ac\ud558\uace0 \uc774 stage \uac04\uc5d0\ub294 Queue \ub97c \ud1b5\ud574\uc11c \ub370\uc774\ud130\ub97c \uc8fc\uace0 \ubc1b\uc544\uc11c \uac01 stage \ub9cc\uc758 \uc791\uc5c5\uc744 \ucc98\ub9ac\ud558\ub294 \uc544\ud0a4\ud14d\ucc98\uc785\ub2c8\ub2e4. SEDA \ub294 \ub2e4\uc74c <a href=\"https://www.google.ca/url?sa&#61;t&amp;rct&#61;j&amp;q&#61;&amp;esrc&#61;s&amp;source&#61;web&amp;cd&#61;2&amp;cad&#61;rja&amp;sqi&#61;2&amp;ved&#61;0CDoQFjAB&amp;url&#61;http%3A%2F%2Fwww.eecs.harvard.edu%2F~mdw%2Fpapers%2Fseda-sosp01.pdf&amp;ei&#61;Ev0ZUfCuB8GriALLx4CABg&amp;usg&#61;AFQjCNHGulXCMJpiRQ7QfqK8eF2TLmEVRw\">https://www.google.ca/url?sa&#61;t&amp;rct&#61;j&amp;q&#61;&amp;esrc&#61;s&amp;source&#61;web&amp;cd&#61;2&amp;cad&#61;rja&amp;sqi&#61;2&amp;ved&#61;0CDoQFjAB&amp;url&#61;http%3A%2F%2Fwww.eecs.harvard.edu%2F~mdw%2Fpapers%2Fseda-sosp01.pdf&amp;ei&#61;Ev0ZUfCuB8GriALLx4CABg&amp;usg&#61;AFQjCNHGulXCMJpiRQ7QfqK8eF2TLmEVRw</a> \uc5d0\uc11c \ubcf4\uc2e4 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>\uadf8\ub798\uc11c Cassandra\uc758 \uc18c\uc2a4\ub294 \uc704\uc758 SEDA \uc544\ud0a4\ud14d\ucc98\ub85c \uad6c\ud604\ub418\uc5b4 \uc788\uc73c\ubbc0\ub85c, \uc18c\uc2a4 \ucf54\ub4dc\ub97c \ub530\ub77c\uac00\uae30\uac00 \ubcf5\uc7a1\ud569\ub2c8\ub2e4. \uadf8\ub798\uc11c \ub2e8\uc21c\ud788 \uc18c\uc2a4\ub97c \ubcf4\ub294 \uac83\ubcf4\ub2e4\ub294 \uc5b4\ub5a4 Stage \uac00 \uc788\ub294\uc9c0\ub97c \uc774\ud574\ud558\ub294 \uac8c \uc880 \ub354 \ub3c4\uc6c0\uc774 \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \u00a0org.apache.cassandra.concurrent/StageManager.java\ub97c \uc0b4\ud3b4\ubcf4\uba74 \ub429\ub2c8\ub2e4. multiThreadedConfigurableStage \ub098 multiThreadedStage \uc758 \uacbd\uc6b0 \ub450\ubc88\uc9f8 \ud30c\ub77c\ub9e4\ud130\ub294 \uba87\uac1c\uc758 \uc2a4\ub808\ub4dc\ub97c \uc0dd\uc131\ud560 \uac83\uc778\uc9c0\ub97c \ub098\ud0c0\ub0c5\ub2c8\ub2e4. </p>\n\n    static\n    {\n        stages.put(Stage.MUTATION, multiThreadedConfigurableStage(Stage.MUTATION, getConcurrentWriters()));\n        stages.put(Stage.READ, multiThreadedConfigurableStage(Stage.READ, getConcurrentReaders()));\n        stages.put(Stage.REQUEST_RESPONSE, multiThreadedStage(Stage.REQUEST_RESPONSE, FBUtilities.getAvailableProcessors()));\n        stages.put(Stage.INTERNAL_RESPONSE, multiThreadedStage(Stage.INTERNAL_RESPONSE, FBUtilities.getAvailableProcessors()));\n        stages.put(Stage.REPLICATE_ON_WRITE, multiThreadedConfigurableStage(Stage.REPLICATE_ON_WRITE, getConcurrentReplicators(), MAX_REPLICATE_ON_WRITE_TASKS));\n        // the rest are all single-threaded\n        stages.put(Stage.GOSSIP, new JMXEnabledThreadPoolExecutor(Stage.GOSSIP));\n        stages.put(Stage.ANTI_ENTROPY, new JMXEnabledThreadPoolExecutor(Stage.ANTI_ENTROPY));\n        stages.put(Stage.MIGRATION, new JMXEnabledThreadPoolExecutor(Stage.MIGRATION));\n        stages.put(Stage.MISC, new JMXEnabledThreadPoolExecutor(Stage.MISC));\n        stages.put(Stage.READ_REPAIR, multiThreadedStage(Stage.READ_REPAIR, FBUtilities.getAvailableProcessors()));\n        stages.put(Stage.TRACING, tracingExecutor());\n    }\n\n<p> \uac01\uac01\uc758 Stage \uc5d0\uc11c \ud558\ub294 \uc5ed\ud560\uc740 \uc880 \ub354 \uc790\uc138\ud788 \uc0b4\ud3b4\ubcf8 \ud6c4\uc5d0 \ub2e4\uc2dc \uacf5\uc720\ud558\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. </p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1468/\"></a> "}, "published": 1360658657, "categories": []}, {"updated": 1360550703, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/11/%ec%9e%85-%ea%b0%9c%eb%b0%9c-cassandra-thrift-command-map/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Cassandra thrift Command map", "author": "charsyam", "content": {"content": "<p>Cassadra \uc758 \uacbd\uc6b0 thrift\ub97c \uc774\uc6a9\ud574\uc11c \ud074\ub77c\uc774\uc5b8\ud2b8\uc640 \ud1b5\uc2e0\uc744 \ud558\uac8c\ub429\ub2c8\ub2e4.(Avro\ub3c4 \uc788\uc9c0\ub9cc \uc77c\ub2e8\uc740 \uc0dd\ub7b5) \uc774 \ucabd \ucf54\ub4dc\ub294 Command Pattern\uc744 \ud1b5\ud574\uc11c \ucc98\ub9ac\ud558\uac8c \ub418\uace0, \uac01\uac01\uc758 Command\ub294 processMap \uc774\ub77c\ub294 \uacf3\uc5d0 \uc800\uc7a5\ub429\ub2c8\ub2e4. (interface/thrift/gen-java/Cassandra.java \uc5d0 \uc874\uc7ac)</p>\n\n    private static &lt;I extends Iface&gt; Map&lt;String,  org.apache.thrift.ProcessFunction&lt;I, ? extends  org.apache.thrift.TBase&gt;&gt; getProcessMap(Map&lt;String,  org.apache.thrift.ProcessFunction&lt;I, ? extends  org.apache.thrift.TBase&gt;&gt; processMap) {\n      processMap.put(&#34;login&#34;, new login());\n      processMap.put(&#34;set_keyspace&#34;, new set_keyspace());\n      processMap.put(&#34;get&#34;, new get());\n      processMap.put(&#34;get_slice&#34;, new get_slice());\n      processMap.put(&#34;get_count&#34;, new get_count());\n      processMap.put(&#34;multiget_slice&#34;, new multiget_slice());\n      processMap.put(&#34;multiget_count&#34;, new multiget_count());\n      processMap.put(&#34;get_range_slices&#34;, new get_range_slices());\n      processMap.put(&#34;get_paged_slice&#34;, new get_paged_slice());\n      processMap.put(&#34;get_indexed_slices&#34;, new get_indexed_slices());\n      processMap.put(&#34;insert&#34;, new insert());\n      processMap.put(&#34;add&#34;, new add());\n      processMap.put(&#34;remove&#34;, new remove());\n      processMap.put(&#34;remove_counter&#34;, new remove_counter());\n      processMap.put(&#34;batch_mutate&#34;, new batch_mutate());\n      processMap.put(&#34;atomic_batch_mutate&#34;, new atomic_batch_mutate());\n      processMap.put(&#34;truncate&#34;, new truncate());\n      processMap.put(&#34;describe_schema_versions&#34;, new describe_schema_versions());\n      processMap.put(&#34;describe_keyspaces&#34;, new describe_keyspaces());\n      processMap.put(&#34;describe_cluster_name&#34;, new describe_cluster_name());\n      processMap.put(&#34;describe_version&#34;, new describe_version());\n      processMap.put(&#34;describe_ring&#34;, new describe_ring());\n      processMap.put(&#34;describe_token_map&#34;, new describe_token_map());\n      processMap.put(&#34;describe_partitioner&#34;, new describe_partitioner());\n      processMap.put(&#34;describe_snitch&#34;, new describe_snitch());\n      processMap.put(&#34;describe_keyspace&#34;, new describe_keyspace());\n      processMap.put(&#34;describe_splits&#34;, new describe_splits());\n      processMap.put(&#34;trace_next_query&#34;, new trace_next_query());\n      processMap.put(&#34;describe_splits_ex&#34;, new describe_splits_ex());\n      processMap.put(&#34;system_add_column_family&#34;, new system_add_column_family());\n      processMap.put(&#34;system_drop_column_family&#34;, new system_drop_column_family());\n      processMap.put(&#34;system_add_keyspace&#34;, new system_add_keyspace());\n      processMap.put(&#34;system_drop_keyspace&#34;, new system_drop_keyspace());\n      processMap.put(&#34;system_update_keyspace&#34;, new system_update_keyspace());\n      processMap.put(&#34;system_update_column_family&#34;, new system_update_column_family());\n      processMap.put(&#34;execute_cql_query&#34;, new execute_cql_query());\n      processMap.put(&#34;execute_cql3_query&#34;, new execute_cql3_query());\n      processMap.put(&#34;prepare_cql_query&#34;, new prepare_cql_query());\n      processMap.put(&#34;prepare_cql3_query&#34;, new prepare_cql3_query());\n      processMap.put(&#34;execute_prepared_cql_query&#34;, new execute_prepared_cql_query());\n      processMap.put(&#34;execute_prepared_cql3_query&#34;, new execute_prepared_cql3_query());\n      processMap.put(&#34;set_cql_version&#34;, new set_cql_version());\n      return processMap;\n    }\n\n<p> \ud639\uc2dc\ub098 \uc2f6\uc5b4\uc11c \uc800\uc7a5\ud574\ub461\ub2c8\ub2e4. </p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1463/\"></a> "}, "published": 1360550703, "categories": []}, {"updated": 1360542576, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/11/%ec%9e%85-%ea%b0%9c%eb%b0%9c-how-to-build-cassandra-with-eclipse/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] How to build cassandra with Eclipse", "author": "charsyam", "content": {"content": "<p>\uac11\uc790\uae30 Cassandra \uc18c\uc2a4\ucf54\ub4dc\uac00 \ubcf4\uace0 \uc2f6\uc5b4\uc838\uc11c, \ube4c\ub4dc\ub97c \uc2dc\ub3c4\ud574\ubd24\uc2b5\ub2c8\ub2e4. Cassandra\ub97c eclipse \uc5d0\uc11c \ube4c\ub4dc\ud558\ub294 \ubc29\ubc95\uc740 \uad49\uc7a5\ud788 \uc27d\uc2b5\ub2c8\ub2e4. cassandra\ub97c \ube4c\ub4dc\ud558\uae30 \uc704\ud574\uc11c\ub294 ant 1.8.1 \uc774\uc0c1\uc774 \ud544\uc694\ud569\ub2c8\ub2e4. \uc800\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 git \uc744 \ud1b5\ud574\uc11c cassandra\ub97c \ubc1b\uc558\uc2b5\ub2c8\ub2e4. \ub2e4\uc74c \uba85\ub839\uc744 \ud1b5\ud574\uc11c Eclipse \uc5d0\uc11c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>\n\ngit clone http://git-wip-us.apache.org/repos/asf/cassandra.git cassandra-trunk\ncd cassandra-trunk\nant build\nant generate-eclipse-files\n\n<p>\ud574\ub2f9 \uc791\uc5c5\uc774 \ub05d\ub098\uba74 \ub2e4\uc74c\uacfc \uac19\uc740 \uc21c\uc11c\ub97c \ub530\ub985\ub2c8\ub2e4.</p>\n<ul>\n<li>File -&gt; New -&gt; Java Project \uc120\ud0dd</li>\n<li>Project \uba85\uc744 cassandra-trunk \ub85c \uc815\ud558\uace0 Use Default Location \uc744 \ud574\uc81c\ud55c \ub2e4\uc74c \uc544\uae4c \uc804\uc5d0 \uc18c\uc2a4 \ucf54\ub4dc\ub97c \ubc1b\uc740 \ub514\ub809\ud1a0\ub9ac\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.</li>\n<li>Next -&gt; Finish \ud558\uc2dc\uba74 \uae30\ubcf8\uc801\uc73c\ub85c Cassandra \ud504\ub85c\uc81d\ud2b8\uac00 \uc644\uc131\ub429\ub2c8\ub2e4.</li>\n</ul>\n<p>\uc774 \ud6c4\uc5d0 \uc2e4\uc81c \uc2e4\ud589\uc744 \ud560 \uc218 \uc788\ub3c4\ub85d Run Configuration \uc744 \uc124\uc815\ud569\ub2c8\ub2e4.</p>\n<ul>\n<li>Run -&gt; Run Configuration \uc744 \uc120\ud0dd\ud569\ub2c8\ub2e4.</li>\n<li>Java Application \uc744 \uc120\ud0dd\ud574\uc11c New Configuration\uc744 \ub9cc\ub4ed\ub2c8\ub2e4.</li>\n<li>Main \ud0ed\uc5d0\uc11c Main Class \ub97c\u00a0org.apache.cassandra.service.CassandraDaemon \ub97c \uc124\uc815\ud569\ub2c8\ub2e4. \uc774\uac83\uc740 \uc18c\uc2a4 \ucf54\ub4dc\ub97c \ud574\ub2f9 \ud074\ub798\uc2a4\uc5d0\uc11c \ubd80\ud130 \uc0b4\ud3b4\ub098\uac00\uba74 \ub41c\ub2e4\ub77c\ub294 \uac83\uc744 \uc54c\ub824\uc90d\ub2c8\ub2e4.</li>\n<li>Arguments \ud0ed\uc5d0\uc11c \ub2e4\uc74c \uac12\uc744 VM arguments\ub85c \uc124\uc815\ud569\ub2c8\ub2e4. \ub514\ub809\ud1a0\ub9ac \uba85\uc744 \uc790\uc2e0\uc758 \uc704\uce58\uc5d0 \ub9de\ucd94\uba74 \ub429\ub2c8\ub2e4.</li>\n</ul>\n\n\n-Dcassandra.config&#61;file:C:\\projects\\cassandra-trunk\\conf\\cassandra.yaml\n-Dcassandra-foreground\n-ea -Xmx1G\n-Dlog4j.configuration&#61;file:C:\\projects\\cassandra-trunk\\conf\\log4j-server.properties\n\n\n<p>\uc774 \uc774\ud6c4\uc5d0 cassandra.yaml \uc5d0\uc11c /var/lib \ub77c\uace0 \ub418\uc5b4 \uc788\ub294 \uacbd\ub85c\ub4e4\uc744 \ubaa8\ub450 \uc790\uc2e0\uc758 \ud504\ub85c\uc81d\ud2b8 \uacbd\ub85c\ub85c \uc124\uc815\ud574\uc918\uc57c \ud569\ub2c8\ub2e4. \uc774\uc81c cassandra \ub294 \uc815\uc0c1\uc801\uc73c\ub85c \uc2e4\ud589\uc774 \ub418\ub294\ub370, \uacbd\uc6b0\uc5d0 \ub530\ub77c\uc11c cassandra-cli \uac00 \ub3d9\uc791\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0\uac00 \uc788\uc2b5\ub2c8\ub2e4.</p>\n\n\nC:\\projects\\cassandra-trunk\\bin&gt;.\\cassandra-cli.bat\nStarting Cassandra Client\nConnected to: &#34;Test Cluster&#34; on 127.0.0.1/9160\nWelcome to Cassandra CLI version Unknown\n\nException in thread &#34;main&#34; org.yaml.snakeyaml.error.YAMLException: java.io.IOExc\neption: Stream closed\n at org.yaml.snakeyaml.reader.StreamReader.update(StreamReader.java:149)\n at org.yaml.snakeyaml.reader.StreamReader.peek(StreamReader.java:116)\n at org.yaml.snakeyaml.reader.StreamReader.peek(StreamReader.java:105)\n at org.yaml.snakeyaml.scanner.ScannerImpl.scanToNextToken(ScannerImpl.ja\nva:961)\n at org.yaml.snakeyaml.scanner.ScannerImpl.fetchMoreTokens(ScannerImpl.ja\nva:234)\n at org.yaml.snakeyaml.scanner.ScannerImpl.checkToken(ScannerImpl.java:18\n0)\n at org.yaml.snakeyaml.parser.ParserImpl$ParseImplicitDocumentStart.produ\nce(ParserImpl.java:199)\n at org.yaml.snakeyaml.parser.ParserImpl.peekEvent(ParserImpl.java:162)\n at org.yaml.snakeyaml.parser.ParserImpl.checkEvent(ParserImpl.java:147)\n at org.yaml.snakeyaml.composer.Composer.getSingleNode(Composer.java:103)\n\nat org.yaml.snakeyaml.constructor.BaseConstructor.getSingleData(BaseCons\ntructor.java:117)\n at org.yaml.snakeyaml.Loader.load(Loader.java:52)\n at org.yaml.snakeyaml.Yaml.load(Yaml.java:166)\n at org.apache.cassandra.cli.CliClient.loadHelp(CliClient.java:188)\n at org.apache.cassandra.cli.CliClient.getHelp(CliClient.java:173)\n at org.apache.cassandra.cli.CliClient.printBanner(CliClient.java:199)\n at org.apache.cassandra.cli.CliMain.main(CliMain.java:304)\nCaused by: java.io.IOException: Stream closed\n at java.io.PushbackInputStream.ensureOpen(PushbackInputStream.java:57)\n at java.io.PushbackInputStream.read(PushbackInputStream.java:149)\n at org.yaml.snakeyaml.reader.UnicodeReader.init(UnicodeReader.java:83)\n at org.yaml.snakeyaml.reader.UnicodeReader.read(UnicodeReader.java:113)\n at java.io.Reader.read(Reader.java:123)\n at org.yaml.snakeyaml.reader.StreamReader.update(StreamReader.java:147)\n ... 16 more\n\n\n<p>CliMain.java \ucf54\ub4dc\ub97c \uc0b4\ud3b4\ubcf4\uba74 loadHelp() \ub77c\ub294 \ud568\uc218\uc5d0\uc11c org/apache/cassandra/cli/CliHelp.yaml \uc744 \ucc3e\ub294\ub370 \uc2e4\ud328\ud558\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>\n\n    private CliUserHelp loadHelp()\n    {\n        final InputStream is &#61; CliClient.class.getClassLoader().getResourceAsStream(&#34;org/apache/cassandra/cli/CliHelp.yaml&#34;);\n        assert is !&#61; null;\n\n        try\n        {\n            final Constructor constructor &#61; new Constructor(CliUserHelp.class);\n            TypeDescription desc &#61; new TypeDescription(CliUserHelp.class);\n            desc.putListPropertyType(&#34;commands&#34;, CliCommandHelp.class);\n            final Yaml yaml &#61; new Yaml(new Loader(constructor));\n            return (CliUserHelp) yaml.load(is);\n        }\n        finally\n        {\n            FileUtils.closeQuietly(is);\n        }\n    }\n\n<p>\uc774\ub97c \ud574\uacb0\ud558\ub294 \ubc29\ubc95\uc740 \uac04\ub2e8\ud569\ub2c8\ub2e4. \ud574\ub2f9 \ud30c\uc77c\uc744 \ubcf5\uc0ac\ud574\uc11c org/apache/cassandra/cli/ \uc5d0 \ubcf5\uc0ac\ud574\uc8fc\uace0 eclipse refresh \ud6c4\uc5d0 \uc7ac\ube4c\ub4dc \ud574\uc8fc\uba74 \uadf8 \ub2e4\uc74c\ubd80\ud130\ub294 \uc815\uc0c1\uc801\uc73c\ub85c \uc2e4\ud589\ub418\uac8c \ub429\ub2c8\ub2e4. \uc544\ub2c8\uba74 \uc774 loadhelp \uc774\uc804\uc5d0 \ud638\ucd9c\ud574\uc8fc\ub294 \ubd80\ubd84\uc744 \ube7c\ubc84\ub824\ub3c4 \uac00\ub2a5\ud569\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>Reference:<a href=\"http://wiki.apache.org/cassandra/RunningCassandraInEclipse\">\u00a0http://wiki.apache.org/cassandra/RunningCassandraInEclipse</a></p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1457/\"></a> "}, "published": 1360542576, "categories": []}, {"updated": 1360218264, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/07/%ec%9e%85-%ea%b0%9c%eb%b0%9c-redis%ec%9d%98-mem_fragmentation_ratio-%eb%8a%94-%ec%96%b4%eb%96%bb%ea%b2%8c-%ea%b5%ac%ed%95%a0%ea%b9%8c/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Redis\uc758 mem_fragmentation_ratio \ub294 \uc5b4\ub5bb\uac8c \uad6c\ud560\uae4c?", "author": "charsyam", "content": {"content": "<p>\uc694\uc0c8 Redis Issue\ub97c \ubcf4\uba74 \uba54\ubaa8\ub9ac\ub97c \uc4f0\uace0 \ub098\ub3c4 \uacc4\uc18d\u00a0mem_fragmentation_ratio \uc640\u00a0used_memory_rss \uac12\uc774 \uc5ec\uc804\ud788 \ub192\ub2e4\ub77c\ub294 \uae00\uc774 \uc790\uc8fc \uc62c\ub77c\uc635\ub2c8\ub2e4. \uc2e4\uc81c\ub85c \uc81c\ubaa9\uc740\u00a0mem_fragmentation_ratio \ub97c \uad6c\ud558\ub294 \ubc29\ubc95\uc774\uc9c0\ub9cc,\u00a0mem_fragmentation_ratio \ub294 \ub2e4\uc74c\uacfc \uac19\uc774 \uac04\ub2e8\ud558\uac8c \uad6c\ud574\uc9d1\ub2c8\ub2e4.(Info Command\ub97c \ud1b5\ud574\uc11c redis\uc5d0\uc11c \ud655\uc778\uac00\ub2a5\ud569\ub2c8\ub2e4.)</p>\n\n\nmem_fragmentation_ratio &#61; used_memory_rss /\u00a0zmalloc_used_memory\n\n\n<p>\ucf54\ub4dc\ub97c \ubcf4\uba74 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p>\n\n\n/* Fragmentation &#61; RSS / allocated-bytes */\n\nfloat zmalloc_get_fragmentation_ratio(void) {\n return (float)zmalloc_get_rss()/zmalloc_used_memory();\n}\n\n\n<p>\uadf8\ub807\ub2e4\uba74 \uc0ac\uc2e4 \ud575\uc2ec\uc740 zmalloc_get_rss\ub97c \uc5b4\ub5bb\uac8c \uad6c\ud558\ub294\uac00\uac00 \ud575\uc2ec\uc774\ub77c\ub294 \uac78 \uc54c\uac8c\ub429\ub2c8\ub2e4.<br>\nrss \uac12\uc744 \uad6c\ud558\ub294 \uac83\uc740 \uc5ec\ub7ec\uac00\uc9c0 \uc815\ucc45\uc774 \uc788\ub294\ub370 proc \ub97c \uc81c\uacf5\ud574\uc8fc\ub294 \uacf3\uc5d0\uc11c\ub294 /proc/{pid}/stat \uac12\uc744 \uc77d\uc5b4\uc11c \ud574\ub2f9 \uac12\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. 24\ubc88\uc9f8 \uac12\uc774 RSS \uc758 \ud398\uc774\uc9c0 \uac1c\uc218\uc785\ub2c8\ub2e4. TASK_INFO\ub97c \uc81c\uacf5\ud574\uc8fc\ub294 \uacf3\uc5d0\uc11c\ub294 \ud574\ub2f9 \ud568\uc218\ub97c \uc774\uc6a9\ud574\uc11c rss \uac12\uc744 \uad6c\ud558\uace0, \uc774\ub3c4 \uc800\ub3c4 \uc5c6\ub294 \ud50c\ub7ab\ud3fc\uc740 \uadf8\ub0e5 zmalloc_used_memory\ub97c \ub9ac\ud134\ud569\ub2c8\ub2e4.(\uc774\ub54c\ub294 \ubb34\uc870\uac74 ratio \uac00 1\uc774 \ub418\uaca0\uc8e0?)</p>\n<p>\ucf54\ub4dc\ub294 zmalloc.c\uc5d0 \uc874\uc7ac\ud558\uace0 \ub9ac\ub205\uc2a4\uc5d0\uc11c proc\ub97c \uc77d\uc5b4\uc11c \ucc98\ub9ac\ud558\ub294 \uac83\uc740 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. \ucf54\ub4dc\ub294 \uc6cc\ub099 \uac04\ub2e8\ud574\uc11c \ub2e4\ub978 \uc124\uba85\uc740 \uc5c6\uc2b5\ub2c8\ub2e4. \ud575\uc2ec\uc740 rss \uac12\uc744 \uc77d\uc5b4\uc624\ub294 \uac83\uacfc, sysconf \ub97c PAGESIZE\ub97c \uac00\uc838\uc635\ub2c8\ub2e4. rss \uac00 \ud398\uc774\uc9c0 \uac1c\uc218\uc774\ubbc0\ub85c \uc5ec\uae30\uc5d0 PAGESIZE\ub97c \uacf1\ud558\uba74 \uc2e4\uc81c \uc0ac\uc6a9\ud558\uace0 \uc788\ub294 \ucd1d \uba54\ubaa8\ub9ac \uc591\uc774 \ub098\uc635\ub2c8\ub2e4.(OS\uac00 \ud398\uc774\uc9c0 \ub2e8\uc704\ub85c \uba54\ubaa8\ub9ac\ub97c \ud560\ub2f9\ud558\ubbc0\ub85c \u314e\u314e\u314e \uc774\uac8c \uc2e4\uc81c \uc0ac\uc6a9\ub7c9\uc774 \ub429\ub2c8\ub2e4.)</p>\n\nsize_t zmalloc_get_rss(void) {\n int page &#61; sysconf(_SC_PAGESIZE);\n size_t rss;\n char buf[4096];\n char filename[256];\n int fd, count;\n char *p, *x;\n\nsnprintf(filename,256,&#34;/proc/%d/stat&#34;,getpid());\n if ((fd &#61; open(filename,O_RDONLY)) &#61;&#61; -1) return 0;\n if (read(fd,buf,4096) &lt;&#61; 0) {\n close(fd);\n return 0;\n }\n\nclose(fd);\n\np &#61; buf;\n count &#61; 23; /* RSS is the 24th field in /proc/&lt;pid&gt;/stat */\n while(p &amp;&amp; count--) {\n p &#61; strchr(p,&#39; &#39;);\n if (p) p&#43;&#43;;\n }\n if (!p) return 0;\n x &#61; strchr(p,&#39; &#39;);\n if (!x) return 0;\n *x &#61; &#39;\\0&#39;;\n\nrss &#61; strtoll(p,NULL,10);\n rss *&#61; page;\n return rss;\n}\n\n<p>/proc/{pid}/stat \uc758 \uc815\ubcf4\ub294 \ub2e4\uc74c \ud398\uc774\uc9c0\ub97c \ubcf4\uc2dc\uba74 \ub429\ub2c8\ub2e4.</p>\n<p><a href=\"http://www.lindevdoc.org/wiki//proc/pid/stat\">http://www.lindevdoc.org/wiki//proc/pid/stat</a></p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1418/\"></a> "}, "published": 1360218264, "categories": []}, {"updated": 1360138905, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/06/%ec%9e%85-%ea%b0%9c%eb%b0%9c-redis-internals-pubsub/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Redis Internals : PubSub", "author": "charsyam", "content": {"content": "<p>\uc624\ub298\uc740 Redis \ub97c \uc0ac\uc6a9\ud558\ub294 \ud070 \uc774\uc720\uc911\uc5d0 \ud558\ub098\uc778 Publish/Subscribe \uc5d0 \ub300\ud574\uc11c \uc54c\uc544\ubcf4\ub824\uace0 \ud569\ub2c8\ub2e4.</p>\n<p>\uba3c\uc800 Redis\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 pubsub \uad00\ub828 command \ub4e4\uc740 \ub2e4\uc74c\uacfc \uac19\uc740 \uac83\ub4e4\uc774 \uc788\uc2b5\ub2c8\ub2e4.</p>\n<ul>\n<li>subscribe<br>\n</li>\n<li>unsubscribe</li>\n<li>psubscribe</li>\n<li>punsubscribe</li>\n<li>publish</li>\n</ul>\n<p>\u00a0</p>\n<p>\uc0ac\uc2e4 publish \uad00\ub828 \uba85\ub839\uc740 \ud558\ub098 \ubfd0\uc774\ub2c8 \uac04\ub2e8\ud558\uac8c \uc774\ud574\ud560 \uc218 \uc788\uc744 \uac83\uc774\uace0, \u00a0\uc55e\uc5d0 p\uac00 \ubd99\ub290\ub0d0 \uc544\ub2c8\ub0d0\ub294 \uc774\uac8c pattern \uc73c\ub85c \ub4f1\ub85d\uc744 \ud558\ub290\ub0d0, \uc815\ud655\ud55c \ucc44\ub110\uba85\uc778\uac00\ub97c \uc9c0\uc815\ud558\uac8c \ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4\uc11c subscribe \ub294 \uadf8\ub0e5 \ucc44\ub110\uba85\uacfc \uc77c\uce58\ud558\ub294 \uac83\uc758 \ub370\uc774\ud130\ub97c \uac00\uc838\uc624\uac8c \ub418\uace0, \uc55e\uc5d0 p\uac00 \ubd99\ub294 psubscribe \ub294 \ud328\ud134\uc744 \ub4f1\ub85d\ud574\uc11c \uadf8 \ud328\ud134\uacfc \uc77c\uce58\ud558\uba74 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud558\uac8c \ub429\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>pub/sub\uc758 \uad6c\ud604\uc744 \uc704\ud574\uc11c redisServer \uad6c\uc870\uccb4 \uc548\uc5d0\ub294 \ub2e4\uc74c\uacfc \uac19\uc740 \uad6c\uc870\uccb4\uac00 2\uac1c\uac00 \uc788\uc2b5\ub2c8\ub2e4. key\ubcc0\uacbd\uc5d0 \ub300\ud55c notification \ubd80\ubd84\uc774 \ucd94\uac00\ub418\uc5c8\ub294\ub370, \uc774 \ubd80\ubd84\uc740 \uadf8\ub0e5 \u00a0pub/sub\uc744 \uc774\uc6a9\ud558\uae30 \ub54c\ubb38\uc5d0 \uc77c\ub2e8 \uc0dd\ub7b5\ud558\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n\n\n/* Pubsub */\n dict *pubsub_channels; /* Map channels to list of subscribed clients */\n list *pubsub_patterns; /* A list of pubsub_patterns */\n\n\n<p>\u00a0</p>\n<p>\ubcf4\uba74 \ucc44\ub110\uc740 dict \uace0 pattern\uc740 list\uc778\uac78 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \uc774\uac74 channel\uc740 \uac19\uc740 \uc774\ub984\uc744 hash\ub85c\ub9cc \ucc3e\uc73c\uba74 \ub418\ub294\ub370, pattern\uc740 \ud574\ub2f9 pattern\uc774 \ubaa8\ub450 \uc77c\uce58\ud558\ub294 \uc9c0\ub97c \ud655\uc778\ud574\uc57c \ud558\uae30 \ub54c\ubb38\uc5d0 \uadf8\ub807\uc2b5\ub2c8\ub2e4. \uc989 \uc5ec\uae30\uc11c pattern\uc744 \ub9ce\uc774 \uc0ac\uc6a9\ud558\uba74, \ub290\ub824\uc9c8\uaebc\ub77c\ub294 \uac83\uc744 \uc608\uc0c1\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>subscribe \uc640 psubscribe\uc5d0\uc11c \ub4f1\ub85d \uacfc\uc815\uc740 \uac01\uac01 dict \uc5d0 \ub123\uac70\ub098 list\uc5d0 \ub123\ub294 \uac83\uc774 \uc804\ubd80\ub77c \ud06c\uac8c \ubcfc \ubd80\ubd84\uc774 \uc5c6\uace0, publish \ubd80\ubd84\uc744 \uc0b4\ud3b4\ubcf4\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4. publish \uacfc\uc815\uc740 \ub450 \ub2e8\uacc4\ub85c \uc774\ub8e8\uc5b4\uc9d1\ub2c8\ub2e4.</p>\n<ol>\n<li>channel \uc5d0 \uc788\ub294 \uac83\uc911\uc5d0 \uc77c\uce58\ud558\ub294 \uac83\uc744 dictFind \ub85c \ucc3e\uc544\uc11c \uc788\uc73c\uba74 \ud574\ub2f9 \ub4f1\ub85d\ub41c \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uac8c \ubaa8\ub450 \uc804\uc1a1</li>\n<li>pattern \uc5d0 \uc77c\uce58\ud558\ub294 \uac83\uc744 \ucc3e\uc544\uc11c \ud574\ub2f9 \ub4f1\ub85d\ub41c \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uac8c \ubaa8\ub450 \uc804\uc1a1</li>\n</ol>\n<p>\ucf54\ub4dc\ub294 \uac04\ub2e8\ud569\ub2c8\ub2e4. \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4.</p>\n\n\n/* Publish a message */\nint pubsubPublishMessage(robj *channel, robj *message) {\n int receivers &#61; 0;\n struct dictEntry *de;\n listNode *ln;\n listIter li;\n\n/* Send to clients listening for that channel */\n de &#61; dictFind(server.pubsub_channels,channel);\n if (de) {\n list *list &#61; dictGetVal(de);\n listNode *ln;\n listIter li;\n\nlistRewind(list,&amp;li);\n\nwhile ((ln &#61; listNext(&amp;li)) !&#61; NULL) {\n redisClient *c &#61; ln-&gt;value;\n\naddReply(c,shared.mbulkhdr[3]);\n addReply(c,shared.messagebulk);\n addReplyBulk(c,channel);\n addReplyBulk(c,message);\n receivers&#43;&#43;;\n }\n }\n /* Send to clients listening to matching channels */\n\nif (listLength(server.pubsub_patterns)) {\n listRewind(server.pubsub_patterns,&amp;li);\n channel &#61; getDecodedObject(channel);\n while ((ln &#61; listNext(&amp;li)) !&#61; NULL) {\n pubsubPattern *pat &#61; ln-&gt;value;\n\nif (stringmatchlen((char*)pat-&gt;pattern-&gt;ptr,\n sdslen(pat-&gt;pattern-&gt;ptr),\n (char*)channel-&gt;ptr,\n sdslen(channel-&gt;ptr),0)) {\n addReply(pat-&gt;client,shared.mbulkhdr[4]);\n addReply(pat-&gt;client,shared.pmessagebulk);\n addReplyBulk(pat-&gt;client,pat-&gt;pattern);\n addReplyBulk(pat-&gt;client,channel);\n addReplyBulk(pat-&gt;client,message);\n receivers&#43;&#43;;\n }\n }\n decrRefCount(channel);\n }\n return receivers;\n}\n\n\n<p>\u00a0</p>\n<p>\uc704\uc758 \uc18c\uc2a4 \ucf54\ub4dc\ub97c \ubcf4\uba74 \uc2e4\uc81c\u00a0pubsub_channels \uacfc\u00a0pubsub_patterns \uac00 \uc804\ubd80 \ub0b4\ubd80\uc5d0 \ub9ac\uc2a4\ud2b8\ub85c \ud074\ub77c\uc774\uc5b8\ud2b8\ub97c \uad00\ub9ac\ud558\uace0 \uc788\ub294 \uac83\uc744 \uc54c \uc218 \uc788\uc2b5\ub2c8\ub2e4. \u00a0Redis \uc548\uc5d0\uc11c pub/sub\uc740 \uad49\uc7a5\ud788 \uc27d\uac8c \uad6c\ud604\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1415/\"></a> "}, "published": 1360138905, "categories": []}, {"updated": 1360051685, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/05/%ec%9e%85-%ea%b0%9c%eb%b0%9c-memcached-%eb%8a%94-predictable-%ed%95%98%ea%b3%a0-redis%eb%8a%94-unpredictable-%ed%95%98%eb%8b%a4/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] memcached \ub294 predictable \ud558\uace0 Redis\ub294 unpredictable \ud558\ub2e4.", "author": "charsyam", "content": {"content": "<p>\uac00\ub054\uc529 Redis\uc640 memcached \ub458 \uc911\uc5d0 \uc5b4\ub5a4 \uac83\uc774 \uc88b\uc740\uac00\uc5d0 \ub300\ud55c \uc9c8\ubb38\uc774 \ub4e4\uc5b4\uc635\ub2c8\ub2e4. \uc774 \uc9c8\ubb38\uc5d0 \ub300\ud55c \ub2f5\ubcc0\uc740 \uadf8\ub54c \uadf8\ub54c \ub2ec\ub77c\uc694\uc785\ub2c8\ub2e4. \u00a0\uc608\ub97c \ub4e4\uc5b4, \uce90\uc2dc\ub85c\ub9cc \uc0ac\uc6a9\ud560 \uac83\uc778\uc9c0? \uc544\ub2c8\uba74 \ub370\uc774\ud130 \uc2a4\ud1a0\uc5b4\ub85c \uc0ac\uc6a9\ud560 \uac83\uc778\uc9c0? \ub370\uc774\ud130 \uc2a4\ud2b8\ub7ed\ucc98\uc758 \uc0ac\uc6a9\uc774 \ud544\uc694\ud55c\uac00 \uc5ec\ubd80 \ub4f1 \uc5ec\ub7ec\uac00\uc9c0 \ud310\ub2e8\uc744 \ud560 \uc218 \uc788\ub294 \uae30\uc900\uc774 \uc788\uc2b5\ub2c8\ub2e4. \uc5ec\uae30\uc11c\ub294 \uc624\uc9c1 \uce90\uc2dc\uc758 \ubaa9\uc801\uc73c\ub85c\ub9cc \ubcfc \ub54c\uc5d0 \ub300\ud55c \uadf8\ub798\uc11c AOF, RDB\ub294 \uc81c\uc678\ud558\uace0 \uc774\uc5d0 \ub300\ud574\uc11c \uac04\ub2e8\ud558\uac8c \uc598\uae30\ud574\ubcfc\ub824\uace0 \ud569\ub2c8\ub2e4.</p>\n<p>\ubcf4\ud1b5\uc758 \uc81c \ub2f5\ubcc0\uc740 \uc0dd\uc0b0\uc131&lt;\uc131\ub2a5 \uc774\uba74 Memcached, \uc0dd\uc0b0\uc131&gt;\uc131\ub2a5 \uc774\uba74 Redis\ub97c \ucd94\ucc9c\ud569\ub2c8\ub2e4. \ub370\uc774\ud130 \uc2a4\ud2b8\ub7ed\ucc98\ub97c \uc81c\uacf5\ud55c\ub2e4\ub294 \uac83\uc740 \uac1c\ubc1c\uc790\uc5d0\uac8c \uc5c4\uccad\ub098\uac8c \ud3b8\uc758\uc131\uc744 \uc81c\uacf5\ud574\uc8fc\ub2c8\uae50\uc694. \uadf8\ub7fc \uc774\uc81c \uc704\uc758 \uc81c\ubaa9\uc5d0 \uad00\uc2ec\uc744 \uac00\uc9c0\uac8c \ub420 \uac83 \uac19\uc2b5\ub2c8\ub2e4. \uc65c memcached\ub294 predictable \ud558\uace0 Redis\ub294 unpredictable \ud55c\uac00? \u00a0\uba3c\uc800 \uc774 \uacfc\uc815\uc740, \ub9ce\uc740 \ub370\uc774\ud130\uac00 set/get/del \ub420 \ub54c\ub77c\ub294 \uac00\uc815\uc785\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uc774\ub294 \ub0b4\ubd80\uc758 \uba54\ubaa8\ub9ac \ud560\ub2f9 \uad6c\uc870\uc758 \ucc28\uc774 \ub54c\ubb38\uc785\ub2c8\ub2e4. \ubaa8\ub450\ub4e4 \uc544\uc2dc\ub2e4\uc2dc\ud53c, Redis\ub294 \ud544\uc694\ud55c \ud06c\uae30 \ub9cc\ud07c\uc5d0 \ub300\ud55c \uba54\ubaa8\ub9ac\ub97c \ud560\ub2f9\ud574\uc11c \uc774\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4. \uadf8\ub7f0\ub370 memcached\ub294 slab \ud560\ub2f9\uc744 \uc774\uc6a9\ud574\uc11c, redis \ubcf4\ub2e4 \uc774\ub7f0 \ubd80\ubd84\uc5d0\uc11c \uc870\uae08 \ub354 \ub098\uc740 \uc131\ub2a5\uc744 \ubcf4\uc5ec\uc90d\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574\uc11c redis\uc758 \uba54\ubaa8\ub9ac\ub294 \uc880 \ub354 fragmentation \uc774 \ubc1c\uc0dd\ud558\uae30 \uc27d\uace0, \u00a0\uc774\ub85c \uc778\ud574 memcached\uc758 \uc131\ub2a5\uc774 \uc880 \ub354 predictable \ud558\ub2e4\uace0 \ud560 \uc218 \uc788\ub294 \uac83\uc785\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>\uadf8\ub7f0\ub370, \uc774\uac8c \uc0ac\uc2e4 \uadf8\ub807\uac8c \ub2e8\uc21c\ud55c \uac83 \ub9cc\uc740 \uc544\ub2d9\ub2c8\ub2e4. memcached\uc758 \uacbd\uc6b0\ub294 4G \uba54\ubaa8\ub9ac\ub97c \ud560\ub2f9\ud558\uba74, \ub370\uc774\ud130 \uc601\uc5ed\ub9cc 4G\uc774\ubbc0\ub85c, \uc774\ub97c \uad00\ub9ac\ud558\uae30 \uc704\ud574\uc11c \uba54\ubaa8\ub9ac\ub97c \ub354 \ub9ce\uc774 \uc0ac\uc6a9\ud558\uac8c \ub429\ub2c8\ub2e4. \uc774\ub85c \uc778\ud574\uc11c \uc758\ub3c4\ud55c \uac83 \uc774\uc0c1\uc73c\ub85c \uba54\ubaa8\ub9ac\ub97c \uc0ac\uc6a9\ud558\uac8c \ub429\ub2c8\ub2e4. \uadf8\ub7f0\ub370 Redis\ub294 \ub531 \uc804\uccb4 \uba54\ubaa8\ub9ac\ub97c \uc124\uc815\ud55c \uac83 \ub9cc\ud07c\ub9cc \uc0ac\uc6a9\ud558\uac8c \ub429\ub2c8\ub2e4.(\uae30\ubcf8\uc740 \ubb34\ud55c\ub300\ub85c \uacc4\uc18d \uc0ac\uc6a9\ud569\ub2c8\ub2e4.) \uc774\ub7f4 \uacbd\uc6b0, swap \ud655\ub960\uc774 \ub35c\ud574\uc11c, \u00a0Redis\uac00 \uc880 \ub354 \uc548\uc815\uc801\uc778 \uc131\ub2a5\uc744 \ubcf4\uc5ec\uc904 \uc218\ub3c4 \uc788\uc2b5\ub2c8\ub2e4. \u00a0\ub2e4\ub9cc BGSAVE\ub97c \uc0ac\uc6a9\ud558\uba74, \ub610 \uba54\ubaa8\ub9ac \uc0ac\uc6a9\ub7c9\uc774 \ub298\uc5b4\ub098\uac8c \ub429\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n<p>\uadf8\ub7fc \uc774\uac83\ub9cc\uc73c\ub85c \ub05d\uc77c\uae4c\uc694? Redis\ub97c \uc5ec\ub7ec \ub300 \uc0ac\uc6a9\ud55c\ub2e4\uba74, \ud55c \uc11c\ubc84\uc5d0 \uc5ec\ub7ec\ub300\uc758 Redis \uc778\uc2a4\ud134\uc2a4\ub97c \ub3cc\ub9ac\uac8c \ub418\ub294\ub370,( memcached \ub3c4 \ub9c8\ucc2c\uac00\uc9c0\uc785\ub2c8\ub2e4. ) \ub2e4\uc74c\uacfc \uac19\uc740 \uad6c\uc870\uac00 \ub429\ub2c8\ub2e4.</p>\n<p><a href=\"http://charsyam.files.wordpress.com/2013/02/ms.png\"></a></p>\n<p>\u00a0</p>\n<p>\uc774\ub807\uac8c \ub418\uba74 \ud558\ub098\uc758 \uc11c\ubc84\uac00 \uc8fd\ub354\ub77c\ub3c4 \uc804\uccb4 \ub370\uc774\ud130\uac00 \ub0a0\ub77c\uac00\uc9c0 \uc54a\ub294 \uc77c\ubd80\ub9cc \uc0ac\ub77c\uc9c0\uac70\ub098, \ubb38\uc81c\uac00 \uc801\uc9c0\ub9cc, AOF/RDB\ub97c \uc0ac\uc6a9\ud574\uc57c \ud55c\ub2e4\uba74 \uc131\ub2a5\uc0c1 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.</p>\n<p>\uc989, \uac04\ub2e8\ud55c \uce90\uc2dc \ub808\uc774\uc5b4 \ud558\ub098\ub97c \uc124\uacc4\ud558\ub354\ub77c\ub3c4, swap\uc758 \ubc1c\uc0dd \uac00\ub2a5\uc131\uc774 \ub2e4\uc591\ud558\uace0, \uc5ec\ub7ec\uac00\uc9c0 \uc758\uc874\uad00\uacc4\uac00 \uc0dd\uae30\uac8c \ub429\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uc774\ub7f0 \uad6c\uc870\ub97c \uc774\ud574\ud558\ub294 \uac83\uc774 \uc801\uc808\ud55c \uce90\uc2dc \uc131\ub2a5\uc744</p>\n<p>\ubcf4\uc7a5\ud558\uac8c \ub429\ub2c8\ub2e4.</p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1411/\"></a> "}, "published": 1360051685, "categories": []}, {"updated": 1359741410, "alternate": [{"href": "http://charsyam.wordpress.com/2013/02/01/%ec%9e%85-%ea%b0%9c%eb%b0%9c-redis-internals-sds/", "type": "text/html"}], "title": "[\uc785 \uac1c\ubc1c] Redis Internals : sds", "author": "charsyam", "content": {"content": "<p>\uba87\uc77c \uc804\uc5d0 Redis\uc758 \uc544\uc774\ud15c \ud558\ub098\uc758 \uba54\ubaa8\ub9ac \ud55c\uacc4\uac00 512MB \ub77c\uace0 \ub9d0\uc500\ub4dc\ub838\uc2b5\ub2c8\ub2e4. \uadf8\ub7ec\uba74, \uc624\ub298\uc740 \uc65c \uadf8\ub7f0\uac00\uc640 \uc774\uac78 \uc218\uc815\ud558\ub824\uace0 \ud558\uba74 Redis\uc5d0\uc11c \uc5b4\ub5a4 \ubd80\ubd84\uc774 \ubc14\ub00c\uc5b4\uc57c \ud560 \uac83\uc778\uc9c0\uc5d0 \ub300\ud574\uc11c \uc124\uba85\uc744 \ud558\ub824\uace0 \ud569\ub2c8\ub2e4. \uadf8\ub9ac\uace0 \uadf8\ub7ec\uae30 \uc704\ud574\uc11c \uc6b0\ub9ac\ub294 sds \ub77c\ub294 Redis\uc5d0\uc11c \uc0ac\uc6a9\ud558\ub294 string \uad6c\uc870\uccb4\ub97c \uc54c \ud544\uc694\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc0ac\uc2e4 sds \ub294 \uadf8\ub0e5 char * \uc785\ub2c8\ub2e4. \uc2e4\uc81c\ub85c \uc815\uc758\ub294 \ub2e4\uc74c\uacfc \uac19\uc774 sds.h \uc5d0 \uc874\uc7ac\ud569\ub2c8\ub2e4.</p>\n\n\ntypedef char *sds;\n\n\n<p>\u00a0</p>\n<p>\uadf8\ub9ac\uace0 \uc774\ub97c \uad00\ub9ac\ud558\uae30 \uc704\ud574\uc11c sdshdr \uc774\ub77c\ub294 \uad6c\uc870\uccb4\ub97c \uc0ac\uc6a9\ud558\ub294 \ub370 \ub2e4\uc74c\uacfc \uac19\uc2b5\ub2c8\ub2e4. len, free, buf \uc138 \uac1c\uc758 \ubcc0\uc218\ub97c \uac00\uc9c0\uace0, len \ud604\uc7ac sds\uc758 \uae38\uc774 free\ub294 sds\uc758 \ub0a8\uc740 \uc6a9\ub7c9, buf\ub294 \uc2e4\uc81c \ubc84\ud37c\ub97c \uac00\ub9ac\ud0a4\ub294 pointer \uc785\ub2c8\ub2e4. \uc989 \ucd5c\ucd08\uc5d0 sdshdr\uc744 \ud558\ub098 \ud560\ub2f9\ud558\uace0, \ub2e4\uc2dc \uac70\uae30\uc5d0 buf\ub97c \ud560\ub2f9\ud574\uc11c buf\ub9cc \ub3cc\ub824\uc8fc\ub294\uac8c sds\uc758 \ud575\uc2ec\uc785\ub2c8\ub2e4. (\uc7a1\ub2f4\ud558\ub098, \uc774\ub7f0 \uad6c\uc870\ub97c \ub9cc\ub4dc\uc2dc\uba74 memory alignment\uc5d0 \uc2e0\uacbd\uc744 \uc368\uc57c \ud569\ub2c8\ub2e4. \uc608\uc804\uc5d0 \uc774\ub7f0 \ud615\ud0dc\uc5d0 \uc55e\uc5d0 len\uc744 2 bytes\ub85c \uc7a1\uc544\uc11c \ucc98\ub9ac\ud55c \uc801\uc774 \uc788\ub294\ub370, \uc77c\ubc18 \uc708\ub3c4\uc6b0 \uc7a5\ube44\uc5d0\uc11c\ub294 \ubb38\uc81c\uac00 \uc5c6\ub2e4\uac00 ARM\uc778\uc9c0 \ud558\ub4dc\ub514\uc2a4\ud06c \ub4dc\ub77c\uc774\ubc84\uac00 \ud2b9\uc774\ud55c \uacf3\uc5d0 \uac14\ub354\ub2c8, \ub370\uc774\ud130\uac00 \uc804\ubd80 0\uc73c\ub85c \ub4e4\uc5b4\uc624\ub294 \ubc84\uadf8\uac00 \u314b\u314b, \uadf8\ub0e5 \uc774\ub807\uac8c 4byte \ub2e8\uc704\ub85c alignment \ub418\ub294 \ud06c\uae30\ub97c \uc7a1\uc73c\uc2dc\uba74 \ub429\ub2c8\ub2e4.)</p>\n<p><a href=\"http://charsyam.files.wordpress.com/2013/02/sds_1.png\"></a></p>\n<p>\u00a0</p>\n<p>\uadf8\ub798\uc11c \uc774 sds \uad00\ub828 \ud568\uc218\ub4e4\uc740 \uc774 sdshdr \uc744 \uc801\uc808\ud788 \ud578\ub4e4\ub9c1\ud558\uac8c \ub429\ub2c8\ub2e4. \uc608\ub97c \ub4e4\uc5b4 sds\uc758 \uae38\uc774\ub97c \uc54c\uace0 \uc2f6\ub2e4\uba74 strlen\uc744 \uc368\ub3c4 \ub418\uc9c0\ub9cc, \ub2e4\uc74c\uacfc \uac19\uc774 sdslen \ud568\uc218\ub97c \uc774\uc6a9\ud558\uba74 \ud6e8\uc52c \ube60\ub974\uac8c \ub429\ub2c8\ub2e4. \uc774\ubbf8 len\uc744 \uac00\uc9c0\uace0 \uc788\uc5b4\uc11c \uadf8\ub807\uc2b5\ub2c8\ub2e4.</p>\n<p>\u00a0</p>\n\n\nstatic inline size_t sdslen(const sds s) {\nstruct sdshdr *sh &#61; (void*)(s-(sizeof(struct sdshdr)));\nreturn sh-&gt;len;\n}\n\n\n<p>\u00a0</p>\n<p>\uadf8\ub7fc \uc774\uac8c \uc65c \ubb38\uc81c\uac00 \ub418\ub294\uac00\ud558\uba74? 32bit\uc5d0\uc11c\ub294 \uba54\ubaa8\ub9ac \ud55c\uacc4\uac00 2G \uc774\ubbc0\ub85c, \ub354 \uc774\uc0c1\uc758 \uba54\ubaa8\ub9ac \ud560\ub2f9\uc774 \uc548\ub429\ub2c8\ub2e4. \uc989 \uae30\uc874\uc758 char *\ud615\ud0dc\ub85c \uc0ac\uc6a9\ud558\ub294 sds \ub294 2G \uc774\uc0c1\uc744 \ucc98\ub9ac\ud558\uc9c0 \ubabb\ud55c\ub2e4\ub294 \uacb0\ub860\uc774 \ub098\uc635\ub2c8\ub2e4.(32bit \uc5d0\uc11c\ub9cc), \uc989 \uc544\uc774\ud15c\uc758 \ud06c\uae30 \uc81c\ud55c\uc744 \uc5c6\uc560\uae30 \uc704\ud574\uc11c\ub294 \uac04\ub2e8\ud558\uac8c 64bit \ub9cc \uc0ac\uc6a9\ud558\uac8c \ud558\ub4e0\uc9c0, \uc544\ub2c8\uba74 \ub0b4\ubd80\uc801\uc73c\ub85c \uc0ac\uc6a9\ud558\ub294 \uc774 sds \ud615\ud0dc\ub97c \uc644\uc804\ud788 \uc0c8\ub86d\uac8c \ub72f\uc5b4\uace0\uccd0\uc57c \ud569\ub2c8\ub2e4. redis \ub0b4\ubd80\uc801\uc73c\ub85c \u00a0sds\ub97c \uc0c1\ub2f9\ud788 \ub9ce\uc774 \uc0ac\uc6a9\ud558\ubbc0\ub85c, \uc804\uccb4\uc801\uc778 \uad6c\uc870 \uc870\uc815\uc774 \ub420\uac83 \uac19\uc2b5\ub2c8\ub2e4. \u00a0\uadf8\ub7fc sds \uc5d0 \ub300\ud55c \uc124\uba85\uc744 \ub9c8\uce69\ub2c8\ub2e4.</p>\n<br>  <a href=\"http://feeds.wordpress.com/1.0/gocomments/charsyam.wordpress.com/1408/\"></a> "}, "published": 1359741410, "categories": []}], "updated": 1366184931, "description": {"content": "Just another WordPress.com weblog"}, "fid": "HLqC6", "title": "Charsyam's Blog"}